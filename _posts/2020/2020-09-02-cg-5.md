---
layout: article
title: "The Notes of Computer Graphics Ⅴ"
aside:
  toc: true
sidebar:
  nav: Computer Graphics
tags:
  - computer graphics
  - notes
key: blog-2020-09-02-cg-5
date: 2020-09-02
modify_date: 2020-09-03
mathjax: true
---

Shading

<!--more-->

## Shading

### Done so far

- Model transformation
- View transformation
- Projection transformation
- Viewport transformation
- Rasterization

![cg-5-1](https://s3.ax1x.com/2021/01/05/skwP9U.jpg){:width="600px"}

- The color applied to each pixel has not been determined yet.


### Blinn-Phong Reflectance Model

**Shading**: The process of applying a material to an object.

- **Specular highlight**: the bright spot of light that apperas on shiny objects when illuminated. Direct light
- **Diffuse lighting**: when a surface that faces an angle 90 degrees or less of the light, it will get a percentage of the light source. Direct light, but diverted from the light source
- **Ambient lighting**: light of the environment, most of which comes from reflected surfaces (by diffusion). Indirect light and not in the path of light source

**Tip**: We often assume ambient lighting is a constant.
{:.info}

![cg-5-2](https://s3.ax1x.com/2021/01/05/skw9hT.jpg){:width="600px"}

### Shading point

- Compute light reflected toward camera at a specific **shading point**
- Inputs:
  - Viewer direction $v$
  - Surface normal $n$
  - Light direction $l$
  - Surface parameters, properties (color, shininess, etc.)

**Caveat**: Above are all **unit** vectors.
{:.error}

![cg-5-3](https://s3.ax1x.com/2021/01/05/skwFc4.jpg){:width="400px"}

- Shading is local, so **No Shadows** will be generated! (**shading ≠ shadow**) 
  
- The below region in red rectangular is blocked by the object from the light source, but we still shade color to it since **shading is local**. The shadow of this area will be discussed [later]()

![cg-5-4](https://s3.ax1x.com/2021/01/05/skwi3F.jpg){:width="400px"}

## Blinn-Phong Model

### Diffuse reflection

- Light is scattered uniformly in all directions
- Surface color is the same for all viewing directions

![cg-5-5](https://s3.ax1x.com/2021/01/05/skwkjJ.jpg){:width="400px"}

- Lambert's cosine law: determine how much light is received

![cg-5-6](https://s3.ax1x.com/2021/01/05/skwZH1.jpg)

### Light Falloff

- Assume that ideally there is no loss of energy, for each moment of energy transmission, each spherical shell carries the same amount of luminous energy. For each unit space $dS$ on the spherical shell, we assume the energy is the same, so the for each spherical shell, the total amount of energy is $\oint IdS = 4\pi r^2 I$. Thus $I$ is inversely proportional to the square of the distance $r$.

![cg-5-7](https://s3.ax1x.com/2021/01/05/skwEu9.jpg)

**Note**: Above proof is not strict, but intuitive. More strict prove is as follows:
We assume there is no energy loss, so the luminous energy $Q$ from the light source per unit time is the same. According to $\Phi = dQ / dt$, we can get the luminous flux $\Phi$ per time unit is the same. From the definition of luminance: $L_{v} = d^2\Phi / d\Omega dA cos\theta$, the total of luminance $4\pi r^2 L_{v} = d\Phi / d\Omega cos\theta$ should be the same. Thus luminance $L_{v}$ is inversely proportional to the square of  the distance $r$.
{:.warning}

**Caveat**: The relationship between Luminous intensity $l_{v}$ and Luminance $L_{v}$ is not clear in CG.
{:.error}

### Diffuse Term

- Lambertian Shading (Diffuse shading)

- Shading **independent** of view direction $v$

![cg-5-8](https://s3.ax1x.com/2021/01/05/skwVBR.jpg)

- $\max (0, \mathbf{n} \cdot \mathbf{l})$ is to ensure the shading value is always positive even if the light comes from the back of the object

**info**: The energy received is relative to the angle between normal $n$ and light $l$. This is also the reason why we feel cold in winter and hot in summer.
{:.success}

- **Diffuse coefficient**: often defined as 3 or 4 dimensional vector to store the percentage of energy the shading point reflects (not absorb in). Indirectly contain the material information of the object.

![cg-5-9](https://s3.ax1x.com/2021/01/05/skDi38.jpg)


### Specular Term

- Intensity **depends** on view direction
  - Specular highlight close to mirror reflection direction

![cg-5-10](https://s3.ax1x.com/2021/01/05/sAURfS.jpg){:width="600px"}


- $v$ close to mirror direction $\Leftrightarrow$ half vector close to normal

![cg-5-11](https://s3.ax1x.com/2021/01/05/sAUhlQ.jpg)

- **Specular coefficient**: similar to **diffuse coefficient**, to describe the property and material of the object, but specular coefficient always set to 1, which means the shading point emmits white color when the specular reflection happens.

- **phong exponent**: increasing phong exponent $p$ will narrow the reflection lobe and accelerate the decay rate of the specular reflection effect as the angle increased.
  - When the angle between the reflected light and view direction more than 3~5 degree, we suppose specular reflection disappears.

![cg-5-12](https://s3.ax1x.com/2021/01/05/sAUfSg.jpg)

![cg-5-13](https://s3.ax1x.com/2021/01/05/sAU2Y8.jpg){:width="780px"}

**Tip**: Compared to diffuse reflection, we ignore the `energy received term` for simplicity. Note that Blinn-Phong model is just an empirical model.
{:info}

### Ambient Term

- Shading that does not depend on anything
  - Independent of light $l$ and view direction $v$
  - Add constant color to account for disregarded illumination and fill in black shadows
  - This is approximate / fake!
- **Ambient coefficient**: similar to **specular coefficient** and **diffuse coefficient**, but this is always a constant.

![cg-5-14](https://s3.ax1x.com/2021/01/05/sAUgFf.jpg){:width="750px"}

### Blinn-Phong Model

![cg-5-15](https://s3.ax1x.com/2021/01/05/sAU5Os.jpg)


$$\begin{aligned} L &=L_{a}+L_{d}+L_{s} \\ &=k_{a} I_{a}+k_{d}\left(I / r^{2}\right) \max (0, \mathbf{n} \cdot \mathbf{l})+k_{s}\left(I / r^{2}\right) \max (0, \mathbf{n} \cdot \mathbf{h})^{p} \end{aligned}$$

## Shading Frequencies

- Flat (Face) shading (逐片元)
- Gouraud (Vertex) shading (逐顶点)
- Phong (Pixel) shading (逐像素)

### Flat shading

- Shading for each triangle
- `normal vector` of each face is caluculated by cross product of triangle's two edges
- Not good for smooth surfaces

![cg-5-16](https://s3.ax1x.com/2021/01/05/sAUomn.jpg){:width="500px"}


### Gouraud shading

- Shading for each vertices and **interpolate** triangle from vertices
- Each vertex has a normal vector

![cg-5-17](https://s3.ax1x.com/2021/01/05/sAU7T0.jpg){:width="500px"}

- It is easy to obtain vertex normal from the underlying known geometry. e.g. sphere

![cg-5-20](https://s3.ax1x.com/2021/01/05/sAaOEt.jpg){:width="700px"}

- Otherwise vertex normal can be inferred from surrounding triangle:
  - average surrounding face normals
  - weighted average surrounding face normals according to the area of each triangle

$$N_{v}=\frac{\sum_{i} N_{i}}{\left\|\sum_{i} N_{i}\right\|}$$

### Phong shading

- Shading for each pixels across triangle
- `normal vector` of each pixels is interpolated by vertex vector

![cg-5-18](https://s3.ax1x.com/2021/01/05/sAUTwq.jpg){:width="500px"}

**Tip**: `Phong shading` is distinct from `Blinn-Phong reflectance model`
{:.info}

- pixel vector is computed by Barycentric interpolation of vertex normal

![cg-5-22](https://s3.ax1x.com/2021/01/05/sAUXpF.jpg){:width="650px"}

**Caveat**: remember to normalize each normal vector after each step of interpolation.
{:.error}

### Shading difference

- As the model becomes more complex and has more vertices, the difference between three shading models become smaller

![cg-5-19](https://s3.ax1x.com/2021/01/05/sAUqYT.jpg)



## Reference

- [GAMES101, Lingqi Yan](https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html)
- [光能、光通量、光强、亮度](https://www.zhihu.com/question/53080536/answer/133398317) 